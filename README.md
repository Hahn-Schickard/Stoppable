<img src="docs/images/vendor-logo.png" alt="" width="200"/>

# Stoppable

## Description
A header only implementation of a utility classes that help develop multi-threaded code, requires std::thread library and C++11 support.

### Contains:
 * `Stoppable` - A class that provides functionality to start and stop a given routine
 * `StoppableTask` - A class that manages `Stoppable` in a separate thread
 * `JobHandler` - A class that cleans up allocated `std::future` instances from `std::async` calls.

## Documentation
If you want to have the latest documentation with your changes locally, you can generate it with [Doxygen](https://github.com/doxygen/doxygen) from sources by running the following:

```bash
doxygen Doxyfile
```

This will generate html like documentation at `[PROJECT_ROOT]/docs/code_documentation/html`. To use it open the `[PROJECT_ROOT]/docs/code_documentation/html/index.html` file with your browser.

## Dependencies
### Required

* compiler with C++17 support
* cmake 3.24.0 >= - build system generator, used by package generator as well
* python3 - used by utilities and package generator
* conan 2.4.0 >= - dependency handler/package generator, see [SSO Wiki](https://ssowiki.hsg.privat/en/Softwareentwicklung/Cpp/Conan_Package_Manager) for installation

### Optional

* ninja - build system (alternative to `make`)
* clang-format 15.0.7 - to use formatting tools
* clang-tidy 15.0.7 - to use static code analysis
* lcov - to generate code coverage reports
* valgrind - to run memory analysis
* doxygen 1.9.8 >= - to generate documentation from code
* plantuml 1.2023.10 >= - to generate UML diagrams in doxygen

## Visual Studio Code Support

### Recommended Plugins:

* [C/C++](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools)  - provides linking to *inellisense*  and code debuggers
* [CMake Tools](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools) - provides CMake highlighting, configuring, building
* [C++ TestMate](https://marketplace.visualstudio.com/items?itemName=matepek.vscode-catch2-test-adapter) - C++ Unit Test Explorer integration for Test Explorer UI
* [Clang-Format](https://marketplace.visualstudio.com/items?itemName=xaver.clang-format) - provides code formatting
* [Doxygen Documentation Generator](https://marketplace.visualstudio.com/items?itemName=cschlosser.doxdocgen) - provides autogenerated doxygen documentation stubs
* [Code Spell Checker](https://marketplace.visualstudio.com/items?itemName=streetsidesoftware.code-spell-checker) - provides english text spellchecker functionality

## CMake Variant Integration
A CMake variant file is provided with this repository for easy cmake configuration setup. This functionality requires CMake Tools plugin to be installed. After Visual Code has been started Open Control Panel with Cntrl + Shift + P and type in CMake: Select Variant to start configuring your cmake project configuration.

## Building the project

To build the project [CMake](https://cmake.org/) project makefile generation as well as integrated testing and linting tools.

We recommend to create a directory for project makefiles and binaries:

```bash
mkdir build && cd build
```

Once in this new **build** directory, generate the project makefiles for Debug configuration (you can change `Debug` for `Release` if debugging information is not needed):

```bash
cmake .. -DCMAKE_BUILD_TYPE=Debug
```

Once makefiles have been generated, build the project either in **Debug** configuration:

```bash
cmake --build . --target all --config Debug --
```

or **Release** configuration, if previous cmake configuration was set for **Release**:

```bash
cmake --build . --target all --config Release --
```

Once the project is built, it is also possible to use the integrated tests runner to run the provided tests:

```bash
ctest --verbose
```

## Creating local conan package

To create a custom local package first define `VERSION`, `USER` and `CHANEL` environmental variables. These variables will tell conan how to name the package.

- `VERSION` variable specifies package version number in the following format `${MAJOR}.${MINOR}.${PATCH}`. For more information see [Release versioning schema](CONTRIBUTING.md#release-versioning-schema)
- `USER` variable specifies the name of release community (for example `hahn-schickard`, `bincrafters`, etc.), it is used to showcase that this package is outside of [conan-center-index](https://conan.io/center/) repository
- `CHANEL` variable specifies the package type, i.e. if it is a stable, development or nightly release

### Conan v1
To create local conan packages run the following command in project root directory:

```bash
conan create . ${VERSION}@${USER}/${CHANEL} --build=missing
```

### Conan v2

To create local conan packages run the following command in project root directory:

```bash
conan create . --version=${VERSION} --user=${USER} --channel=${CHANEL} --build=missing
```

In case you need to specify C++ standard, run the following command in project root directory:

```bash
conan create . --version=${VERSION} --user=${USER} --channel=${CHANEL} --build=missing -s:h compiler.cppstd=17 -s:b compiler.cppstd=17
```

## Project utility tools

This project comes with integrated utility scripts written in python3 to check code coverage with **gcov** and **lcov**, check for memory leaks with **valgrind** and generate documentation with **Doxygen**. You can use these by running the following:

* `python3 utility/run-lcov.py --help` - to learn how to use **lcov** wrapper
* `python3 utility/run-valgrind.py --help` - to learn how to use **valgrind** wrapper
* `python3 utility/run-clang-tidy.py --help` - to learn how to use **run-clang-tidy** wrapper
* `python3 utility/run-clang-format.py --help` - to learn how to use **run-clang-format** wrapper

Hidden files and scripts within utility directory are used by CI/CD pipeline or as configuration files for the wrappers.

This directory is typically maintained via [Project-Configurator](https://git.hahn-schickard.de/hahn-schickard/software-sollutions/application-engineering/internal/project-configurator) program and SHOULD not be modified manually. Any modifications SHOULD be done in [Project Template](https://git.hahn-schickard.de/hahn-schickard/software-sollutions/application-engineering/internal/project-template/-/tree/cpp) repository instead and updated via [Project-Configurator](https://git.hahn-schickard.de/hahn-schickard/software-sollutions/application-engineering/internal/project-configurator) once released.
